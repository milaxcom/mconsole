var FormImagesUpload=function(e){this.element=e,this.init()};FormImagesUpload.prototype.init=function(){var e=this.element,a=e.find('input[type="file"]').prop("multiple");this.element.find("button.description").on("click",function(){e.find("div.description").map(function(e,a){$(a).hasClass("hide")?$(a).removeClass("hide"):$(a).addClass("hide")})}),this.element.find("tbody.files").sortable({axis:"y",handle:".drag"});var i={disableImageResize:!0,autoUpload:!0,maxNumberOfFiles:50,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:3e7,singleFileUploads:!1,url:"/mconsole/api/images/upload",uploadTemplateId:"template-upload-"+this.element.find("input.uploadable-group").val(),downloadTemplateId:"template-download-"+this.element.find("input.uploadable-group").val()};a||(i.maxNumberOfFiles=1),this.element.fileupload(i),this.element.bind("fileuploaddestroy",function(e,a){e.preventDefault();var i=$(a.context.context).parents("tr"),t=i.find("button.delete");i.find("input.uploadable-filename").val();t.hasClass("disabled")||(t.html('<i class="fa fa-spin fa-spinner"></i>'),t.addClass("disabled"),$.ajax({type:a.type,url:a.url}).success(function(){i.fadeOut("normal",function(){this.remove()})}))}),a||this.element.find('input[type="file"]').on("change",function(){var a=this.value;e.find("tbody.ui-sortable tr").map(function(e,i){$(i).find("p.name").text()!=a&&$(i).remove()})}),this.element.find("input.uploadable-id").val().length>0&&(this.element.addClass("fileupload-processing"),$.ajax({url:"/mconsole/api/images/get/",data:{related_class:this.element.find("input.uploadable-class").val(),related_id:this.element.find("input.uploadable-id").val(),group:this.element.find("input.uploadable-group").val()},dataType:"json",context:this.element[0]}).always(function(){$(this).removeClass("fileupload-processing")}).done(function(e){$(this).fileupload("option","done").call(this,$.Event("done"),{result:e}),$(this).find("tbody.files tr").map(function(e,a){var i=$(a).find("input.uploadable-language-id").val();$(a).find("select").val(i)})}))},$(function(){var e=$(".uploadable");e.length>0&&e.map(function(a){new FormImagesUpload(e.eq(a))})});