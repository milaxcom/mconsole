var FormImagesUpload=function(e){this.element=e,this.init()};FormImagesUpload.prototype.init=function(){var e=this.element,a=e.find('input[type="file"]').prop("multiple");this.element.find("tbody.files").sortable({axis:"y",handle:".drag"});var t={disableImageResize:!0,autoUpload:!0,maxNumberOfFiles:50,disableImageResize:/Android(?!.*Chrome)|Opera/.test(window.navigator.userAgent),maxFileSize:3e7,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,singleFileUploads:!1,url:"/mconsole/api/images/upload",uploadTemplateId:"template-upload-"+this.element.find("input.uploadable-group").val(),downloadTemplateId:"template-download-"+this.element.find("input.uploadable-group").val()};a||(t.maxNumberOfFiles=1),this.element.fileupload(t),this.element.bind("fileuploaddestroy",function(e,a){e.preventDefault();var t=$(a.context.context).parents("tr"),l=t.find("button.delete");t.find("input.uploadable-filename").val();l.hasClass("disabled")||(l.html('<i class="fa fa-spin fa-spinner"></i>'),l.addClass("disabled"),$.ajax({type:a.type,url:a.url}).success(function(){t.fadeOut("normal",function(){this.remove()})}))}),a||this.element.find('input[type="file"]').on("change",function(){var a=this.value;e.find("tbody.ui-sortable tr").map(function(e,t){$(t).find("p.name").text()!=a&&$(t).remove()})}),this.element.find("input.uploadable-id").val().length>0&&(this.element.addClass("fileupload-processing"),$.ajax({url:"/mconsole/api/images/get/",data:{related_class:this.element.find("input.uploadable-class").val(),related_id:this.element.find("input.uploadable-id").val(),group:this.element.find("input.uploadable-group").val()},dataType:"json",context:this.element[0]}).always(function(){$(this).removeClass("fileupload-processing")}).done(function(e){$(this).fileupload("option","done").call(this,$.Event("done"),{result:e})}))},$(function(){var e=$(".uploadable");e.length>0&&e.map(function(a){new FormImagesUpload(e.eq(a))})});