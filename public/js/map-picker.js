var MapPicker;MapPicker=function(){function e(e,t){this.container=e,this.config=t,this.geocoder=new google.maps.Geocoder,this.address=[],(isNaN(this.config.center.lat)||isNaN(this.config.center.lng))&&delete this.config.center,this.defaultConfig={center:{lat:55.7494733,lng:37.3523241},zoom:4},this.config&&$.extend(this.defaultConfig,this.config),this.init()}return e.prototype.use=function(e){return this.useCb=e,this},e.prototype.cancel=function(e){return this.cancelCb=e,this},e.prototype.init=function(){return this.map=new google.maps.Map(this.container.find(".map").get(0),this.config),this.map.addListener("click",function(e){return function(t){return e.setMarker(t.latLng)}}(this)),this.addSearchBox(),0!==this.config.lat&&0!==this.config.lng&&this.setMarker(this.config.center),this.container.on("click",".map-use",function(e){return function(){if(e.useCb)return e.useCb(e.address,e.marker.position.toJSON())}}(this)),this.container.on("click",".map-close",function(e){return function(){if(e.cancelCb)return e.cancelCb()}}(this))},e.prototype.addSearchBox=function(){var e,t;return e=document.getElementById("pac-input"),t=new google.maps.places.SearchBox(e),this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),t.setBounds(this.map.getBounds()),this.map.addListener("bounds_changed",function(e){return function(){return t.setBounds(e.map.getBounds())}}(this)),t.addListener("places_changed",function(e){return function(){var n,o;if(o=t.getPlaces(),0!==o.length)return n=new google.maps.LatLngBounds,o.forEach(function(t){var o;return o={url:t.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},e.setMarker(t.geometry.location),t.geometry.viewport?n.union(t.geometry.viewport):n.extend(t.geometry.location)}),e.map.fitBounds(n)}}(this))},e.prototype.setMarker=function(e,t){return null==t&&(t=null),this.marker&&this.marker.setMap(null),this.marker=new google.maps.Marker({position:e,map:this.map}),this.geocode(e,t),this.marker.setMap(this.map)},e.prototype.geocode=function(e,t){return this.container.block({message:null,overlayCSS:{opacity:0}}),this.geocoder.geocode({location:e},function(e){return function(n,o){var s,r,i;if(e.address=[],o===google.maps.GeocoderStatus.OK&&n.length>0){e.address.push({type:"formatted_address",long_name:n[0].formatted_address});for(s in n[0].address_components)r=n[0].address_components[s],i=r.types[0],e.address.push({type:i,long_name:r.long_name,short_name:r.short_name})}if(e.container.unblock(),e.fillAddressCard(),t)return t(e.address,e.marker.position.toJSON())}}(this))},e.prototype.fillAddressCard=function(){var e,t,n,o,s;if(e=this.container.find(".map-address"),0===this.address.length)e.html("No address info found at selected location.");else{e.html("");for(t in this.address)o=this.address[t],n=o.type.charAt(0).toUpperCase()+o.type.slice(1).split("_").join(" "),s=o.short_name?" ("+o.short_name+")":"",e.append($("<address><strong>"+n+"</strong> ("+o.type+")<br>"+o.long_name+s+"</address>"))}return this.toggleControls()},e.prototype.toggleControls=function(){return 0===this.address.length?this.container.find(".map-use-controls").addClass("hide"):this.container.find(".map-use-controls").removeClass("hide")},e}(),$.fn.mapPicker=function(e){return new MapPicker(this,e)};