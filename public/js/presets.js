var Presets=function(){if(this.json=$('input[name="operations"]'),this.add=$(".preset-add-operation"),this.list=$(".operations-list"),this.json.val().length>5){var t=JSON.parse(this.json.val());for(var e in t)this.appendPresetOperation(t[e])}this.add.on("click",function(){this.appendPresetOperation()}.bind(this)),this.list.on("keyup change click","input, select",this.evalJSON.bind(this))};Presets.prototype.evalJSON=function(){var t=[];this.list.find("form").map(function(e,i){var n={},a=$(i).serializeArray();for(var e in a)n[a[e].name]=a[e].value;t.push(n)}),this.json.val(JSON.stringify(t))},Presets.prototype.appendPresetOperation=function(t){var e=new PresetOperation(this.evalJSON.bind(this),t);this.list.append(e.selector)};var PresetOperation=function(t,e){this.updateCallback=t,this.templates=$(".preset-operation-template"),this.selector=this.makeElement(e),this.selector.find('select[name="operation"]').on("change",this.switchType.bind(this))};PresetOperation.prototype.makeElement=function(t){var e=$(this.templates.find('div[data-type="types"]')).clone();return t&&(e.find('select[name="operation"]').val(t.operation),this.switchType(e.find('select[name="operation"]'),t)),e.on("click",".remove-operation",function(){this.selector.remove(),this.updateCallback&&this.updateCallback()}.bind(this)),e},PresetOperation.prototype.switchType=function(t,e){var i=t.target?$(t.target):$(t);console.log(i);var n=i.parent().next();n.html("");var a=$(this.templates.find('div[data-type="'+i.val()+'"]')).clone();if(e)for(var s in e)a.find('[name="'+s+'"]').val(e[s]);a.length>0&&(a.find(".popovers").popover(),n.html(a))},$(function(){new Presets});