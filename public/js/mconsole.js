var Mconsole=function(){this.notifications={badge:$(".notifications-count"),container:$(".notifications-container"),items:0},this.search={form:$(".search-form"),results:$(".search-results"),icon:$(".search-form").find(".submit i"),ajax:null,data:[]},this.search.form.on("submit",function(){return!1}),$(document).on("click",function(){this.search.form.hasClass("open")&&this.search.data.length>0?this.search.results.show():this.search.results.hide()}.bind(this)),this.search.results.on("click",".search-result-item",function(){window.location.href=$(this).find("a").prop("href")}),this.search.form.on("keyup",this.handleSearch.bind(this));var s=this;s.getNotifications(),setInterval(function(){s.getNotifications()},1e4)};Mconsole.prototype.handleSearch=function(){return this.search.ajax&&this.search.ajax.abort(),0==this.search.form.find("input").val().length?(this.search.results.children().remove(),this.search.results.hide(),void(this.search.data=[])):void(this.search.form.find("input").val().length<3||(this.search.icon.removeClass("icon-magnifier").addClass("fa fa-spin fa-spinner"),this.search.ajax=$.ajax({method:"GET",url:"/mconsole/api/search",data:this.search.form.serialize()}),this.search.ajax.success(this.handleSearchResults.bind(this))))},Mconsole.prototype.handleSearchResults=function(s){if(this.search.data=s,this.search.results.children().remove(),s.length>0){for(var i in s){var t=$('<li class="search-result-item"><a href="'+s[i].link+'"><span class="details">'+s[i].title+"</span>"+s[i].description+"</a></li>");this.search.results.append(t)}this.search.form.hasClass("open")&&this.search.results.show()}else this.search.results.hide();this.search.icon.removeClass("fa fa-spin fa-spinner").addClass("icon-magnifier")},Mconsole.prototype.getNotifications=function(){$.get("/mconsole/api/notifications",this.handleNotifications.bind(this))},Mconsole.prototype.handleNotifications=function(s){this.notifications.container.html("");var i=[];0==s.length?(i.push($('<li>                <a href="javascript:;">                    <span class="details">Нет новых уведомлений</span>                </a>            </li>')),this.notifications.badge.text("")):(i=s.map(function(s){var i=s.link.length>0?s.link:"javascript:;",t=s.link.length>0?'target="_blank"':"",a=s.link.length>0?'<span class="pull-right label label-sm label-icon label-success"><i class="fa fa-external-link"></i> </span>':"";return $li=$('<li data-id="'+s.id+'"><a href="'+i+'" '+t+'><span class="details">'+s.text+a+"</span></a></li>"),$li.on("click",function(i){i.remove(),this.notifications.badge.text(this.notifications.badge-1),$.get("/mconsole/api/notifications/"+s.id+"/seen")}),$li}.bind(this)),this.notifications.badge.text(s.length));for(var t in i)this.notifications.container.append(i[t])},$(document).ready(function(){new Mconsole});