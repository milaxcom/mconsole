var Mconsole=function(){this.notifications={badge:$(".notifications-count"),container:$(".notifications-container"),items:0},this.search={form:$(".search-form"),results:$(".search-results"),icon:$(".search-form").find(".submit i"),ajax:null},$(document).on("click",":not(.search-form) :not(.search-results)",function(i){this.search.results.hide()}.bind(this)),this.search.form.find("input").on("click",function(){this.search.results.show()}.bind(this)),this.search.form.on("submit",function(){return!1}),this.search.form.on("keyup",this.handleSearch.bind(this));var i=this;i.getNotifications(),setInterval(function(){i.getNotifications()},1e4)};Mconsole.prototype.handleSearch=function(){this.search.form.find("input").val().length<3||(this.search.ajax&&this.search.ajax.abort(),this.search.icon.removeClass("icon-magnifier").addClass("fa fa-spin fa-spinner"),this.search.ajax=$.ajax({method:"GET",url:"/mconsole/api/search",data:this.search.form.serialize()}),this.search.ajax.success(this.handleSearchResults.bind(this)))},Mconsole.prototype.handleSearchResults=function(i){if(this.search.results.show().html(""),0==i.length)this.search.results.text("No search results");else{for(var t in i){var s=$('<a href="'+i[t].link+'">'+i[t].text+"</a>");this.search.results.append(s)}}this.search.icon.removeClass("fa fa-spin fa-spinner").addClass("icon-magnifier")},Mconsole.prototype.getNotifications=function(){$.get("/mconsole/api/notifications",this.handleNotifications.bind(this))},Mconsole.prototype.handleNotifications=function(i){this.notifications.container.html("");var t=[];0==i.length?(t.push($('<li>                <a href="javascript:;">                    <span class="details">Нет новых уведомлений</span>                </a>            </li>')),this.notifications.badge.text("")):(t=i.map(function(i){var t=i.link.length>0?i.link:"javascript:;",s=i.link.length>0?'target="_blank"':"",n=i.link.length>0?'<span class="pull-right label label-sm label-icon label-success"><i class="fa fa-external-link"></i> </span>':"";return $li=$('<li data-id="'+i.id+'"><a href="'+t+'" '+s+'><span class="details">'+i.text+n+"</span></a></li>"),$li.on("click",function(t){t.remove(),this.notifications.badge.text(this.notifications.badge-1),$.get("/mconsole/api/notifications/"+i.id+"/seen")}),$li}.bind(this)),this.notifications.badge.text(i.length));for(var s in t)this.notifications.container.append(t[s])},$(document).ready(function(){new Mconsole});