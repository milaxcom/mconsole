machine:
  php:
    version: 5.6.14
  services:
    - mysql

dependencies:
  cache_directories:
    - /home/ubuntu/laravel
  override:
    - cd /home/ubuntu && composer create-project --prefer-dist --no-interaction laravel/laravel laravel
    - cp -rfa /home/ubuntu/mconsole/circle/* /home/ubuntu/laravel
    - cp /home/ubuntu/mconsole/circle/.env /home/ubuntu/laravel/.env
    - mkdir -p /home/ubuntu/laravel/workbench/milax
    - mv /home/ubuntu/mconsole /home/ubuntu/laravel/workbench/milax
    - cd /home/ubuntu/laravel
    - composer update --no-scripts --prefer-source --no-interaction

test:
  override:
    - php artisan mconsole:install --update
    - php artisan migrate --force
    - cd /home/ubuntu/mconsole
    - phpunit