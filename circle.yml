machine:
  php:
    version: 5.6.14
  services:
    - mysql

dependencies:
  override:
    - rm -rf /home/ubuntu/laravel
    - cd /home/ubuntu && composer create-project --prefer-dist --no-interaction laravel/laravel laravel
    - cp -rfa /home/ubuntu/mconsole/ci/* /home/ubuntu/laravel
    - cp /home/ubuntu/mconsole/ci/.env /home/ubuntu/laravel
    - mkdir -p /home/ubuntu/laravel/workbench/milax
    - mv /home/ubuntu/mconsole /home/ubuntu/laravel/workbench/milax
    - cd /home/ubuntu/laravel && composer update --no-scripts --prefer-source --no-interaction

test:
  override:
    - cd /home/ubuntu/laravel && php artisan mconsole:install --update
    - cd /home/ubuntu/laravel && php artisan migrate --force
    - cd /home/ubuntu/laravel/workbench/milax/mconsole && phpunit